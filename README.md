# Бэкенд DatAFake и как его развернуть
## Просто о важном

Проект написан на Python 3.9

Для начала развертывания хорошо бы создать виртуальное окружение и установить туда всё, что перечислено в requirements.txt

Говорю сразу, НЕ ВСЁ, что там перечислено, реально нужно для работы данной версии (на 27.03.2024), поэтому если Вы избирательны, то обязательно нужно установить:

- FastAPI: pip install fastapi[all],
- все остальные библиотеки, которые PyCharm подчеркнёт красным.

Поздравляю, Вы крассавчик!

## Запуск API

Вы преодолели первый этап и хотите большего? Тогда предлагаю запустить наше API! Для этого откройте два терминала в той IDE, где вы работаете, и напишите следующие заклинания:

- в первом: uvicorn preprocessing.src.main:app --port 5000
- во втором: uvicorn inference.src.main:app --port 5050

Убедительно прошу обратить внимание на первую строчку! Необходимо запускать приложение именно на этом порту. Если по какой-то причине он у Вас будет занят, напишите мне, я скажу как решить эту проблему.

Второе приложение можно запускать на любом порту, но не рекомендую делать это на 8000, просто чтобы не терять возможность использовать его для чего-то более важного.

Данные команды запускают приложения на localhost!

## Тестирование эндпоинтов

Итак, Вы почти завершили путь в мир нашего прекрасного API! Осталось попробовать его в действии.

Самый простой способ для этого перейти по адресу localhost/docs (в случае, если Вы не меняли первое заклинание из блока выше) или по адресу localhost:<номер порта>/docs (тут номер порта это тот порт, который Вы указали после ключа --port в блоке выше).

Тут вам откроется документация нашего API. Да, в ней всего один эндпоинт, не пугайтесь, все верно. Как говорил великий:

> Каждый дуб, когда-то был желудем!

Чтобы протестировать эндпоинт сделайте следующие шаги:

- нажмите на эндпоинт (слева есть стрелочка, чтобы его развернуть),
- нажмите на кнопку `Try it out`,
- рядом с надписью **upload_file** выберите файл, который хотите проанализировать,
- нажмите на синюю кнопку с надписью `Execute`.

Осталось подождать, пока файл обработается и Вы сможете посмотреть результат.

Поздравляю! Курс молодого бойца API пройден!

## Онли хардкор без смехуёчков

##### Эндпоинты, которые нужны фронту:

- /api/v1/files/analyze

На вход требует файл, отдает JSON с результатами в формате:
``` 
{ "message": string,
  "response":
      "<id>": list[float] или float,
  "dir_path": string
}
```

Где <id> это порядковый номер лица в формате integer (то есть 0, 1, 2 и тд.). По пути, который указан по ключу "dir_path" лежат фотографии лиц, которые названы по этим ключам. То есть для лица в файле 0.jpg результаты лежат по ключу "0", в файле 1.jpg - по ключу "1" и тд.

Массив из float используется при анализе видео (вероятности для каждого кадра), а просто float при анализе фотографии.

##### Папка, куда кладутся фотографии лиц:

- preprocessing/media

На данный момент это так и написано у меня коряво, поэтому самостоятельно, Наташа, ты вряд ли это исправишь. Когда выделишь на диске конкретную папку, напиши мне, я оформлю по человечески путь до нее через переменные среды, чтобы ее можно было легко менять без копания в моём коде.

##### Порт для запуска основного контейнера

- 5000

На данный момент это так, потому что я не знала, какой порт мы выберем и какие ещё программы могут претендовать на тот же порт по умолчанию, потому взяла малоиспользуемый. Когда мы определимся с финальным портом окончательно, я перенастрою CORS для работы с ним и будем запускать уже на нём.
